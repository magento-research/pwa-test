# wait to start the script until both containers have started
sleep 15;

# there are two containers that start, selenium and MFTF
# kill selenium after the test container has finished running tests
how_many () {
  RUNNING_CONTAINERS=$(docker ps -q | wc -l)  # count starts at 2
}
how_many
# if the count drops to 1 then the tests finished
while [ $RUNNING_CONTAINERS -gt 1 ]; do
  sleep 10;
  how_many
done
echo -e "Containers running: $RUNNING_CONTAINERS\ntests have finished! stopping selenium..."
docker stop $(docker ps -q)

# determine if there were failures 
FAIL_FILE="./dev/tests/acceptance/tests/_output/failed"
if [ -f $FAIL_FILE ]; then
    echo "there were failed tests!"
    cat $FAIL_FILE
    exit 1
fi

exit 0
